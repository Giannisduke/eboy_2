wc_bookings_date_picker={},jQuery(function($){var e=0,a={init:function(){$("body").on("change","#wc_bookings_field_duration, #wc_bookings_field_resource",this.date_picker_init),$("body").on("click",".wc-bookings-date-picker legend small.wc-bookings-date-picker-choose-date",this.toggle_calendar),$("body").on("input",".booking_date_year, .booking_date_month, .booking_date_day",this.input_date_trigger),$("body").on("keypress",".booking_date_year, .booking_date_month, .booking_date_day",this.input_date_keypress),$("body").on("keypress",".booking_to_date_year, .booking_to_date_month, .booking_to_date_day",this.input_date_keypress),$("body").on("change",".booking_to_date_year, .booking_to_date_month, .booking_to_date_day",this.input_date_trigger),$(".wc-bookings-date-picker legend small.wc-bookings-date-picker-choose-date").show(),$(".wc-bookings-date-picker").each(function(){var e=$(this).closest("form"),a=e.find(".picker"),t=$(this).closest("fieldset");wc_bookings_date_picker.date_picker_init(a),"always_visible"==a.data("display")?($(".wc-bookings-date-picker-date-fields",t).hide(),$(".wc-bookings-date-picker-choose-date",t).hide()):a.hide(),a.data("is_range_picker_enabled")&&(e.find("p.wc_bookings_field_duration").hide(),e.find(".wc_bookings_field_start_date legend span.label").text("always_visible"!==a.data("display")?booking_form_params.i18n_dates:booking_form_params.i18n_start_date))})},calc_duration:function(e){var a=e.closest("form"),t=e.closest("fieldset"),i=e.data("duration-unit");setTimeout(function(){var e=1,o=parseInt(t.find("input.booking_to_date_year").val(),10),n=parseInt(t.find("input.booking_to_date_month").val(),10),_=parseInt(t.find("input.booking_to_date_day").val(),10),r=parseInt(t.find("input.booking_date_year").val(),10),d=parseInt(t.find("input.booking_date_month").val(),10),s=parseInt(t.find("input.booking_date_day").val(),10);if(o&&n>=0&&_&&r&&d>=0&&s){var l=new Date(Date.UTC(r,d-1,s)),c=new Date(Date.UTC(o,n-1,_));e=Math.floor((c.getTime()-l.getTime())/864e5),"day"===i&&(e+=1)}a.find("#wc_bookings_field_duration").val(e).change()})},toggle_calendar:function(){$picker=$(this).closest("fieldset").find(".picker:eq(0)"),wc_bookings_date_picker.date_picker_init($picker),$picker.slideToggle()},input_date_keypress:function(){var a=$(this).closest("fieldset"),t=a.find(".picker:eq(0)");t.data("is_range_picker_enabled")&&(clearTimeout(e),e=setTimeout(wc_bookings_date_picker.calc_duration(t),800))},input_date_trigger:function(){var e=$(this).closest("fieldset"),a=e.find(".picker:eq(0)"),t=$(this).closest("form"),i=parseInt(e.find("input.booking_date_year").val(),10),o=parseInt(e.find("input.booking_date_month").val(),10),n=parseInt(e.find("input.booking_date_day").val(),10);if(i&&o&&n){var _=new Date(i,o-1,n);if(a.datepicker("setDate",_),a.data("is_range_picker_enabled")){var r=parseInt(e.find("input.booking_to_date_year").val(),10),d=parseInt(e.find("input.booking_to_date_month").val(),10),s=parseInt(e.find("input.booking_to_date_day").val(),10),l=new Date(r,d-1,s);!l||_>l?(e.find("input.booking_to_date_year").val("").addClass("error"),e.find("input.booking_to_date_month").val("").addClass("error"),e.find("input.booking_to_date_day").val("").addClass("error")):e.find("input").removeClass("error")}e.triggerHandler("date-selected",_)}},select_date_trigger:function(e){var a=$(this).closest("fieldset"),t=a.find(".picker:eq(0)"),i=$(this).closest("form"),o=e.split("-"),n=t.data("start_or_end_date");t.data("is_range_picker_enabled")&&n||(n="start"),"end"===n?(t.data("min_date",t.data("o_min_date")),a.find("input.booking_to_date_year").val(o[0]),a.find("input.booking_to_date_month").val(o[1]),a.find("input.booking_to_date_day").val(o[2]).change(),t.data("is_range_picker_enabled")&&wc_bookings_date_picker.calc_duration(t),t.data("start_or_end_date","start"),t.data("is_range_picker_enabled")&&i.find(".wc_bookings_field_start_date legend span.label").text("always_visible"!==t.data("display")?booking_form_params.i18n_dates:booking_form_params.i18n_start_date),"always_visible"!==t.data("display")&&$(this).hide()):(t.data("is_range_picker_enabled")&&(t.data("o_min_date",t.data("min_date")),t.data("min_date",e)),a.find("input.booking_to_date_year").val(""),a.find("input.booking_to_date_month").val(""),a.find("input.booking_to_date_day").val(""),a.find("input.booking_date_year").val(o[0]),a.find("input.booking_date_month").val(o[1]),a.find("input.booking_date_day").val(o[2]).change(),t.data("is_range_picker_enabled")&&wc_bookings_date_picker.calc_duration(t),t.data("start_or_end_date","end"),t.data("is_range_picker_enabled")&&i.find(".wc_bookings_field_start_date legend span.label").text(booking_form_params.i18n_end_date),"always_visible"===t.data("display")||t.data("is_range_picker_enabled")||$(this).hide()),a.triggerHandler("date-selected",e,n)},date_picker_init:function(e){var a;a=$(e).is(".picker")?$(e):$(this).closest("form").find(".picker"),a.empty().removeClass("hasDatepicker").datepicker({dateFormat:$.datepicker.ISO_8601,showWeek:!1,showOn:!1,beforeShowDay:wc_bookings_date_picker.is_bookable,onSelect:wc_bookings_date_picker.select_date_trigger,minDate:a.data("min_date"),maxDate:a.data("max_date"),defaultDate:a.data("default_date"),numberOfMonths:1,showButtonPanel:!1,showOtherMonths:!0,selectOtherMonths:!0,closeText:wc_bookings_booking_form.closeText,currentText:wc_bookings_booking_form.currentText,prevText:wc_bookings_booking_form.prevText,nextText:wc_bookings_booking_form.nextText,monthNames:wc_bookings_booking_form.monthNames,monthNamesShort:wc_bookings_booking_form.monthNamesShort,dayNamesMin:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],firstDay:wc_bookings_booking_form.firstDay,gotoCurrent:!0}),$(".ui-datepicker-current-day").removeClass("ui-datepicker-current-day");var t=a.closest("form"),i=parseInt(t.find("input.booking_date_year").val(),10),o=parseInt(t.find("input.booking_date_month").val(),10),n=parseInt(t.find("input.booking_date_day").val(),10);if(i&&o&&n){var _=new Date(i,o-1,n);a.datepicker("setDate",_)}},get_input_date:function(e,a){var t=e.find("input.booking_"+a+"date_year"),i=e.find("input.booking_"+a+"date_month"),o=e.find("input.booking_"+a+"date_day");return 0!==t.val().length&&0!==i.val().length&&0!==o.val().length?t.val()+"-"+i.val()+"-"+o.val():""},is_bookable:function(e){var a=$(this).closest("form"),t=a.find(".picker:eq(0)"),i=$(this).data("availability"),o=$(this).data("default-availability"),n=$(this).data("fully-booked-days"),_=$(this).data("buffer-days"),r=$(this).data("partially-booked-days"),d=wc_bookings_booking_form.check_availability_against,s="",l="",c=0,k=wc_bookings_booking_form.resources_assignment;a.find("select#wc_bookings_field_resource").val()>0&&(c=a.find("select#wc_bookings_field_resource").val());var b=wc_bookings_booking_form.booking_duration,g=new Date(e),f=g.getFullYear(),p=g.getMonth()+1,u=g.getDate(),y=f+"-"+p+"-"+u;if(n[y]&&(n[y][0]||n[y][c]))return[!1,"fully_booked",booking_form_params.i18n_date_fully_booked];if(_&&_&&_[y])return[!1,"not_bookable",booking_form_params.i18n_date_unavailable];if(""+f+p+u<wc_bookings_booking_form.current_time)return[!1,"not_bookable",booking_form_params.i18n_date_unavailable];r&&r[y]&&(r[y][0]||r[y][c])&&(s+="partial_booked ");var m=b;if(a.find("#wc_bookings_field_duration").length>0&&"minute"!=wc_bookings_booking_form.duration_unit&&"hour"!=wc_bookings_booking_form.duration_unit&&!t.data("is_range_picker_enabled")){var v=a.find("#wc_bookings_field_duration").val();m=b*v}(1>m||"start"===d)&&(m=1);var h={start_date:e,number_of_days:m,fully_booked_days:n,availability:i,default_availability:o,resource_id:c,resources_assignment:k},w=wc_bookings_date_picker.is_blocks_bookable(h);if(w){if(l=s.indexOf("partial_booked")>-1?booking_form_params.i18n_date_partially_booked:booking_form_params.i18n_date_available,t.data("is_range_picker_enabled")){var D=$(this).closest("fieldset"),I=$.datepicker.parseDate($.datepicker.ISO_8601,wc_bookings_date_picker.get_input_date(D,"")),T=$.datepicker.parseDate($.datepicker.ISO_8601,wc_bookings_date_picker.get_input_date(D,"to_"));return[w,I&&(e.getTime()===I.getTime()||T&&e>=I&&T>=e)?s+"bookable-range":s+"bookable",l]}return[w,s+"bookable",l]}return[w,"not_bookable",booking_form_params.i18n_date_unavailable]},is_blocks_bookable:function(e){for(var a=e.default_availability,t=0;t<e.number_of_days;t++){var i=new Date(e.start_date);i.setDate(i.getDate()+t);var o=i.getFullYear(),n=i.getMonth()+1,_=i.getDate(),r=i.getDay(),d=$.datepicker.iso8601Week(i);0===r&&(r=7);var s={date:i,default_availability:e.default_availability},l=e.availability[e.resource_id];if(a=wc_bookings_date_picker.is_resource_available_on_date(s,l),"automatic"===e.resources_assignment){var c=$.extend({availability:e.availability,fully_booked_days:e.fully_booked_days},s);a=wc_bookings_date_picker.has_available_resource(c)}var k=o+"-"+n+"-"+_;if(e.fully_booked_days[k]&&(e.fully_booked_days[k][0]||e.fully_booked_days[k][e.resource_id])&&(a=!1),!a)break}return a},is_resource_available_on_date:function(e,a){if("object"!=typeof e||"object"!=typeof a)return!1;var t=e.default_availability,i=e.date.getFullYear(),o=e.date.getMonth()+1,n=e.date.getDate(),r=e.date.getDay(),d=new Date(i,0,1),s=Math.ceil(((e.date-d)/864e5+d.getDay()+1)/7);if(0===r&&(r=7),e.fully_booked_days&&e.fully_booked_days[i+"-"+o+"-"+n]&&e.fully_booked_days[i+"-"+o+"-"+n][e.resource_id])return!1;var l=[],c=_.range(1,1440,1);return t&&(l=c),$.each(a,function(e,a){var d=a.type,k=a.range;try{switch(d){case"months":if("undefined"!=typeof k[o])return l=k[o]?c:[],!0;break;case"weeks":if("undefined"!=typeof k[s])return l=k[s]?c:[],!0;break;case"days":if("undefined"!=typeof k[r])return l=k[r]?c:[],!0;break;case"custom":if("undefined"!=typeof k[i][o][n])return l=k[i][o][n]?c:[],!0;break;case"time":case"time:1":case"time:2":case"time:3":case"time:4":case"time:5":case"time:6":case"time:7":if(r===k.day||0===k.day){var b=parseInt(k.from.split(":")[0]),g=parseInt(k.from.split(":")[1]),f=parseInt(k.to.split(":")[0]),p=parseInt(k.to.split(":")[1]),u=g+60*b,y=p+60*f,m=_.range(u,y,1);return l=k.rule?_.union(l,m):_.difference(l,m),!0}break;case"time:range":!1===t&&"undefined"!=typeof k[i][o][n]&&(l=c)}}catch(v){return!0}}),!_.isEmpty(l)},get_week_number:function(e){var a=new Date(e.getFullYear(),0,1),t=Math.ceil(((e-a)/864e5+a.getDay()+1)/7);return t},has_available_resource:function(e){for(var a in e.availability)if(a=parseInt(a,10),0!==a){var t=e.availability[a];if(e.resource_id=a,wc_bookings_date_picker.is_resource_available_on_date(e,t))return!0}return!1}};wc_bookings_date_picker=a,wc_bookings_date_picker.init()});
//# sourceMappingURL=./date-picker-min.js.map